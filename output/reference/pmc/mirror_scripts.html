<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download page (mirror script) migration steps # - Apache Infrastructure</title>
    <link rel="stylesheet" href="https://infra-test.apache.org/theme/css/foundation.css">
    <link rel="stylesheet" href="https://infra-test.apache.org/theme/css/app.css">
    <link rel="stylesheet" href="https://infra-test.apache.org/theme/css/font-awesome.min.css">
  </head>
  <body style="background: #C9B191;">
    <!-- Menu bar --->
    <div class="row">
      <div class="top-bar" style="padding: 0; margin-bottom: 10px; background: #222; border: 1px solid #DDD; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px;">
        <div class="hide-for-small-only">
          <div class="top-bar-left">
            <ul class="menu" style="background: #222; padding: 0px; line-height: 1; border-bottom-left-radius: 4px;">
              <li class="notable-logo"><a href="/" target="_self" style="padding: 3px; padding-left: 7px;">
                <img style="vertical-align: middle;" src='https://infra-test.apache.org/theme/images/feather.png' width='18'/><span style="font-size: 1.30rem; color: #1583CC; text-transform: uppercase;">Apache Infrastructure</span></a>
              </li>
            </ul>
          </div>
          <div class="top-bar-right">
            <ul class="dropdown menu horizontal" data-dropdown-menu style="background: #222; font-size: 0.8rem; text-transform: uppercase; padding-top: 5px;">
              <li><a href="/reference/" target="_self" style="padding-left: 5px;">Documentation</a></li>
              <li class="is-dropdown-submenu-parent">
                <a href="#" target="_self" style="padding-left: 0px;">Services and Status</a>
                <ul class="menu" style="background: #222; font-size: 0.7rem; text-transform: uppercase; padding-top: 5px; margin-top: 5px;">
                <li><a href="https://status.apache.org/" >Status Report</a></li>
                <li><a href="https://issues.apache.org/jira/" >JIRA</a></li>
                <li><a href="https://cwiki.apache.org/" >Confluence</a></li>
                <li><a href="https://builds.apache.org/" >Jenkins</a></li>
                <li><a href="https://ci.apache.org/" >Buildbot</a></li>
                </ul>
              </li>
              <li class="is-dropdown-submenu-parent">
                <a href="#" target="_self" style="padding-left: 7px;">Self Serve</a>
                <ul class="menu" style="background: #222; font-size: 0.7rem; text-transform: uppercase; padding-top: 5px; margin-top: 5px;">
                  <li><a href="/self-serve/acreq/">Account requests</a></li>
                  <li><a href="/self-serve/mlreq/">Mailing lists</a></li>
                  <li><a href="/self-serve/reporeq/">New git repository</a></li>
                  <li><a href="/self-serve/id/">Edit account information</a></li>
                  <li><a href="/contact.html">Other inquiries</a></li>
                </ul>
              </li>
              <li class="is-dropdown-submenu-parent">
                <a href="#" target="_self" style="padding-left: 7px;">About</a>
                <ul class="menu" style="background: #222; font-size: 0.7rem; text-transform: uppercase; padding-top: 5px; margin-top: 5px;">
                  <li><a href="/team.html">About the team</a></li>
                  <li><a href="/policies.html">Our policies</a></li>
                  <li><a href="/roadmap.html">Strategies & Roadmap</a></li>
                  <li><a href="/contact.html">Contact infrastructure</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>    
    <!-- bread crumb -->
    <div class="row">
      <div class="large-12 columns" style="font-size: 0.8rem; background-color: rgba(255,255,255,0.75); margin-bottom: 5px;">
        <a href="/">Home</a>
        <i class="fa fa-angle-double-right"></i>
        <a href="https://infra-test.apache.org/reference/pmc/mirror_scripts.html">
Download page (mirror script) migration steps #        </a>
      </div>
    </div>
    
    
    <!-- contents -->
    <div class="row">
      <div class="large-12 columns">
        <div class="callout">
          <h2>
              Download page (mirror script) migration steps #
          </h2>
              <p>This document outlines the simple changes needed to migrate from the old download mirror system to the new one:</p>
<h3>Using <code>www.apache.org/dyn/closer.cgi</code> in your download .cgi script?</h3>
<p>Change this to <code>www.apache.org/dyn/closer.lua</code>!</p>
<h3>Using a .cgi with an accompanying .html file with the same name?</h3>
<p>Great, you probably don't need to do anything! But check that the script works OK to make sure.</p>
<p>Note: the system relies on finding the .html file in the same directory as the .cgi file.
If your site uses redirects, that may break the linkage.
See below for details as these may affect how the page is displayed.</p>
<h3>Using <code>.htaccess</code> files that redirect or refer to a .cgi file?</h3>
<p>You may need to make changes, as all <code>.cgi</code> files are now being internally rewritten. 
The redirect of the <code>.cgi</code> file occurs before the <code>.htaccess</code> file is processed so the mirror system won't see any redirects applied by your <code>.htaccess</code> file to the <code>.cgi</code> file.</p>
<p>You can fix this by updating the links to .cgi files to point to the same parent directory as the redirected <code>.html</code> file.
The <code>.cgi</code> file does not actually have to be present at the target location.</p>
<p>However fixing ASF website pages won't fix existing links which may appear on 3rd party sites. The only way to fix these is to ensure that the HTML file is accessible at the same (un-redirected) URL as the CGI file. </p>
<p>If the HTML redirect is to another directory in the same site, then a simple file link should suffice.</p>
<p>Alternatively an HTML file may be created in the original location; this should have a meta-redirect to the redirected location of the CGI file (not the HTML file). The meta-redirect will be processed and the CGI reference will again be intercepted; this time it is in the correct location.</p>
<p>For example, <code>commons.apache.org/lang/</code> currently redirects to <code>commons/proper/commons-lang/</code>
This means that references to <code>/lang/download\_lang.cgi</code> no longer work properly.<br>
Solution 1:<br>
Create a link from <code>../proper/commons-lang/download\_lang.html</code> to <code>lang/download\_lang.html</code><br>
Solution 2:<br>
Create the file <code>lang/download\_lang.html</code> with the content</p>
<div class="highlight"><pre><span></span><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;refresh&quot;</span> <span class="na">content=</span><span class="s">&quot;0; url=/proper/commons-lang/download_lang.cgi&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>


<p>If the .htaccess redirects are changed later, any such fixes may have to be changed.</p>
<h3>Creating new download links?</h3>
<p>You may want to adopt either <code>closer.lua</code> or simply have an EZT template (see <a href="http://tomcat.apache.org/download-80.html">this Tomcat example</a> or <a href="http://svn.apache.org/viewvc/tomcat/site/trunk/docs/download-80.html?view=co&amp;content-type=text%2Fplain">source of Tomcat example</a>) called <code>download.html</code> and then point to <code>download.cgi</code> to have our new system use your template via internal rewrites.</p>
<h3>Using a custom CGI file for your downloads?</h3>
<p>Please have a static EZT template (see example above) only, call it <code>download.html</code> (or equivalent) and refer to it as <code>download.cgi</code> to have our mirror system pick up the template and use it. You can also call it <code>download-foo.html</code> and refer to it as <code>download-foo.cgi</code> to have it rendered via our mirror system.</p>
<h3>Using SSI (Server-Side Includes) in your current download page?</h3>
<p>This <strong>won't</strong> work anymore, please use a static html template (see above)</p>
<h3>Still having trouble?</h3>
<p>Contact us at <a href="mailto:infrastructure@apache.org">infrastructure@apache.org</a> or visit us on <a href="http://infra.chat/">HipChat</a> !</p>
        </div>
      </div>
    </div>
    </div>    
    <!-- footer -->
    <div class="row">
      <div class="large-12 medium-12 columns">
        <p style="font-style: italic; font-size: 0.8rem; text-align: center;">
          Copyright 2016, <a href="https://www.apache.org/">The Apache Software Foundation</a>, Licensed under the Apache License, Version 2.0.<br/>
          Apache and the Apache feather logo are trademarks of The Apache Software Foundation.
        </p>
      </div>
    </div>    
    <script src="https://infra-test.apache.org/theme/js/vendor/jquery.js"></script>
    <script src="https://infra-test.apache.org/theme/js/vendor/what-input.js"></script>
    <script src="https://infra-test.apache.org/theme/js/vendor/foundation.js"></script>
    <script src="https://infra-test.apache.org/theme/js/app.js"></script>
  </body>
</html>
