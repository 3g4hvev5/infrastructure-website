<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Using OPIE</title>
        <link rel="stylesheet" href="https://infra-test.apache.org/theme/css/main.css" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://infra-test.apache.org/">Apache Infrastructure </a></h1>
                <nav><ul>
                    <li><a href="https://infra-test.apache.org/pages/committer-outreach.html">Policy for Outreach to Committers</a></li>
                    <li><a href="https://infra-test.apache.org/pages/contact.html">Contact the Infrastructure Team</a></li>
                    <li><a href="https://infra-test.apache.org/pages/reference/committer/contactinfra.html">Contacting Infrastructure</a></li>
                    <li><a href="https://infra-test.apache.org/pages/reference/committer/email.html">Committer e-mail configuration</a></li>
                    <li><a href="https://infra-test.apache.org/pages/fingerprints.html">Fingerprints</a></li>
                    <li><a href="https://infra-test.apache.org/pages/reference/committer/git.html">Getting started with Git</a></li>
                    <li><a href="https://infra-test.apache.org/pages/reference/committer/github.html">Apache and GitHub</a></li>
                    <li><a href="https://infra-test.apache.org/pages/help.html">Requesting assistance</a></li>
                    <li><a href="https://infra-test.apache.org/pages/reference/committer/id.html">Changing your account details (self serve)</a></li>
                    <li><a href="https://infra-test.apache.org/pages/reference/committer/index.html">Committer Documentation</a></li>
                    <li><a href="https://infra-test.apache.org/pages/reference/index.html">Reference Documentation</a></li>
                    <li><a href="https://infra-test.apache.org/pages/self-serve/index.html">Self-serve Tools</a></li>
                    <li><a href="https://infra-test.apache.org/pages/reference/committer/jenkins-docker.html">Using Docker with builds.apache.org</a></li>
                    <li><a href="https://infra-test.apache.org/pages/machines.html">ASF Machines, Hosts, and Services</a></li>
                    <li><a href="https://infra-test.apache.org/pages/reference/committer/newaccount.html">Guide to new committers</a></li>
                    <li class="active"><a href="https://infra-test.apache.org/pages/reference/committer/opie.html">Using OPIE</a></li>
                    <li><a href="https://infra-test.apache.org/pages/policies.html">Policies for Apache Infrastructure</a></li>
                    <li><a href="https://infra-test.apache.org/pages/reference/committer/release.html">Releasing project packages</a></li>
                    <li><a href="https://infra-test.apache.org/pages/roadmap.html">Roadmap for Apache Infrastructure</a></li>
                    <li><a href="https://infra-test.apache.org/pages/services-tools.html">Services and Tools</a></li>
                    <li><a href="https://infra-test.apache.org/pages/sla.html">Service Level Agreement (SLA)</a></li>
                    <li><a href="https://infra-test.apache.org/pages/reference/committer/ssh.html">Setting up SSH for ASF machines</a></li>
                    <li><a href="https://infra-test.apache.org/pages/reference/committer/start.html">Committer documentation</a></li>
                    <li><a href="https://infra-test.apache.org/pages/reference/committer/subversion.html">Using Subversion</a></li>
                    <li><a href="https://infra-test.apache.org/pages/reference/committer/svngit2jira.html">Subversion and Git integration with JIRA tickets</a></li>
                    <li><a href="https://infra-test.apache.org/pages/team.html">About the Apache Infrastructure Team</a></li>
                    <li><a href="https://infra-test.apache.org/pages/volunteer.html">Volunteering for Apache Infrastructure</a></li>
                    <li><a href="https://infra-test.apache.org/pages/reference/committer/website-policy.html">Web Site Guidelines</a></li>
                    <li><a href="https://infra-test.apache.org/pages/reference/committer/website.html">How To Manage any Apache Project's Website</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
    <h1 class="entry-title">Using OPIE</h1>
    
    <p>This document covers the setup and use of OPIE (One-time Passwords In Everything). This is
a mechanism used by the ASF that ensures that your sudo password is not erroneously intercepted
or pasted into the wrong prompt on the remote machine.</p>
<p>Note: FreeBSD uses <code>opiepasswd</code>, Ubuntu VM's use <code>ortpasswd</code> (part of Orthrus) instead.</p>
<p>All users in the wheel group (or in the $machine-sudoers in LDAP) have sudo access.
In order to use sudo, a user <strong>must
configure OPIE</strong> by running <code>opiepasswd</code> on the remote machine.</p>
<h1>Getting an OPIE client for your computer</h1>
<p>Using OPIE requires having an OPIE (S/Key) client on the local (trusted) machine. Some OPIE clients are:</p>
<ul>
<li>Debian/Ubuntu: See <a href="http://ubuntuforums.org/showthread.php?t=1891356">this forum thread</a></li>
<li>Browser-based: <a href="/committer/otp-md5">otp-md5 tool in JavaScript</a></li>
<li>SkeyCalc (Mac OS X)</li>
<li>Orthrus (Unix-like; portable)</li>
<li>FreeBSD: opiekey(1) is part of the base system</li>
<li>donkey (Debian package donkey) Note: Use the '-f' option to set the hash type, usually 'donkey -f md5'</li>
</ul>
<h1>Setting up OPIE:</h1>
<ol>
<li>pick a good passphrase, between 10 and 127 characters long.</li>
<li>never expose it to the net, <strong>never type it on the remote machine</strong></li>
<li>run <code>opiepasswd</code> (or <code>ortpasswd</code>)on the remote machine you wish to get sudo access to.</li>
<li>that will prompt you with an otp challenge, for instance: <code>otp-md5 fo1834 470</code></li>
<li>take that challenge string and run it <strong>locally on your workstation</strong></li>
<li>enter your passphrase at the <strong>local prompt</strong> in 5</li>
<li>repeat 5 and 6 until you are <em>certain</em> you entered your pw correctly</li>
<li>paste the resulting six word response into the challenge prompt in 4. If you get a 20014 error,
you have entered your password remotely by mistake, please contact infra if so.</li>
<li>have someone add you to the 'wheel' group</li>
<li>run sudo</li>
<li>that will prompt you for an otp challenge</li>
<li>repeat steps 5-8</li>
<li>get root</li>
</ol>
<h1>An example:</h1>
<h2>Remote machine you want to get sudo access to:</h2>
<pre><code>foo@test-vm.apache.org# opiepasswd
You need the response from an OTP generator.
New secret pass phrase:
otp-md5 499 fo4576  &lt;-- COPY THIS STRING
Response:
</code></pre>
<h2>Local machine:</h2>
<pre><code>$ otp-md5 499 fo4576
Using the MD5 algorithm to compute response.
Reminder: Don't use opiekey from telnet or dial-in sessions.
Enter secret pass phrase: foobarbaztwothirty
WERE GAIL THUG CEIL VIE TWO  &lt;-- COPY THESE WORDS
</code></pre>
<h2>Remote machine:</h2>
<pre><code>    Response: WERE GAIL THUG CEIL VIE TWO
root@test-vm.apache.org #
</code></pre>
<h2>Video Tutorial</h2>
<p><video controls src="https://home.apache.org/~gmcdonald/using_opie_orthrus.mov"><a href="https://home.apache.org/~gmcdonald/using_opie_orthrus.mov">Setting up Orthrus using SKeyCalc on Mac</a>
</video></p>

</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>